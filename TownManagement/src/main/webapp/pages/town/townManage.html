<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>管理</title>
<link rel="stylesheet"
	href="../tools/bootstrap-table/dist/bootstrap-table.min.css" />
</head>
<body>
	<div class="row">
		<div class="col-lg-12">
			<h3 class="page-header">中心镇管理</h3>
		</div>
	</div>
	<div class="row">
		<div class="col-lg-12">
			<table id="townmanagetable" ></table>
		</div>
	</div>
	<!-- 模态框（Modal） 小镇详情-->
	<div class="modal fade" id="towninfomodal" tabindex="-1" role="dialog"
		aria-labelledby="myModalLabel" style="padding-top: 5%;">
		<div class="modal-dialog" style="width:60%;">
			<div class="modal-content">
				<div class="modal-body" id="towninfobody">
					页面初始化失败
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal -->
	</div>
		<!-- 模态框（Modal） success-->
	<div class="modal fade" id="townmanage-success" tabindex="-1"
		role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
		style="padding-top: 15%;">
		<div class="modal-dialog" style="width: 300px">
			<div class="modal-content">
				<div class="modal-body" align="center">保存成功!</div>
			</div>
		</div>
	</div>
	<!-- 模态框（Modal） fail-->
	<div class="modal fade" id="townmanage-fail" tabindex="-1" role="dialog"
		aria-labelledby="myModalLabel" aria-hidden="true"
		style="padding-top: 15%;">
		<div class="modal-dialog" style="width: 300px">
			<div class="modal-content">
				<div class="modal-body" align="center">保存失败!</div>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="../tools/bootstrap-table/dist/bootstrap-table.js"></script>
	<script type="text/javascript" src="../tools/bootstrap-table/dist/locale/bootstrap-table-zh-CN.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			$('#townmanagetable').bootstrapTable({
				url : '../townmanage/querytowninfo',
				method : 'get', //请求方式（*）
				toolbar : '#toolbar', //工具按钮用哪个容器
				striped : true, //是否显示行间隔色
				cache : false, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
				pagination : true, //是否显示分页（*）
				sortable : false, //是否启用排序
				sortOrder : "asc", //排序方式
				queryParamsType : "undefined",
				queryParams : queryParams,//传递参数（*）
				sidePagination : "server", //分页方式：client客户端分页，server服务端分页（*）
				pageSize : 10,
				pageList : [ 10, 25, 50, 100 ], //可供选择的每页的行数（*）
				search : true,
				showToggle : true,
				showRefresh : true,//显示刷新按钮
				strictSearch : true,//设置为 true启用 全匹配搜索，否则为模糊搜索
				clickToSelect : true, //是否启用点击选中行
				height : 520, //行高，如果没有设置height属性，表格自动根据记录条数调整表格高度
				//cardView : false, //是否显示详细视图
				//detailView : true, //是否显示父子表
				columns : [ {
					field : 'number',
					title : '编号',
					align : 'center',
					width : '20%'
				}, {
					field : 'centertownname',
					title : '中心镇名称',
					editable : true,
					align : 'center',
					width : '20%'
				}, {
					field : 'attributionarea',
					title : '归属地',
					align : 'center',
					width : '20%'
				}, {
					field : 'townlevel',
					title : '小镇等级',
					align : 'center',
					width : '20%'
				}, {
                    title : '操作',
                    field : 'centertownid',
                    width :	'20%',
                    align : 'center',
                    formatter:function(value,row,index){
                    	var query = '<a href="javascript:void(0)" onclick="querytowndetail('+row.centertownid+')">查看</a>';
                    	var update = '<a href="javascript:void(0)" onclick="updatetowninfo('+row.centertownid+')">修改</a>'
                    	return query+"&nbsp"+update;
                    }
				} ]
			});
		})
		//查询方法
		function queryParams(params){
			if (params.searchText == undefined) {
				params.searchText = "";
			}
			var temp = { //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
				limit : params.pageSize, //页面大小
				offset : params.offset, //页码
				maxrows : params.limit,
				pageindex : params.pageNumber,
				search : encodeURI(params.searchText)
			};
			return temp;
		}
		//展示详情modal
		function querytowndetail(centertownid) {
			$.ajax({
				url : "town/townEntry.html",
				cache : false,
				async: false,
				success : function(html) {
					$("#towninfobody").html(html);
					$.ajax({
						url : "../townmanage/querytowndetail",
						async: false,
						data : {"centertownid":centertownid},
						dataType : 'JSON',
						success : function(data, status) {
							values = $("#townform").serializeArray(); 
							$.each(values,function(i){
								var id=values[i].name;
								var dataStr=data[0];
								$.each(dataStr,function(i){  
								    var key = i;  
								    var value = dataStr[i];
								    if(id==key){
								    	$('#'+id).val(value);
								    }
								});  
							});
							var arr=data[0].industrialorientation.split(",");
							$('#industrialorientation').selectpicker();  
							$('#industrialorientation').selectpicker('val', arr);
						}
					});
					$("#towninfomodal").modal('show');
					$("#townentry_submit").hide();
				}
			});
		}
		//展示修改界面
		function updatetowninfo(centertownid){
			$.ajax({
				url : "town/townEntry.html",
				cache : false,
				async: false,
				success : function(html) {
					$("#towninfobody").html(html);
					$.ajax({
						url : "../townmanage/querytowndetail",
						async: false,
						data : {"centertownid":centertownid},
						dataType : 'JSON',
						success : function(data, status) {
							values = $("#townform").serializeArray(); 
							$.each(values,function(i){
								var id=values[i].name;
								var dataStr=data[0];
								$.each(dataStr,function(i){  
								    var key = i;  
								    var value = dataStr[i];
								    if(id==key){
								    	$('#'+id).val(value);
								    }
								});  
							});
							var arr=data[0].industrialorientation.split(",");
							$('#industrialorientation').selectpicker();  
							$('#industrialorientation').selectpicker('val', arr);
						}
					});
					$("#towninfomodal").modal('show');
					$("#townentry_submit").hide();
					$("#townentry_update").show();
				}
			});
		}
	</script>
</body>
</html>